# divide-lame-iTunes.pl + divide-auto.pl

## 概要

### divide-lame-iTunes.pl

アナログレコードやカセットテープ、ライブ等を録音した音声ファイルを
分割(端点のフェード), mp3圧縮, iTunes取り込み
するためのスクリプトです。
(perl, sox, lame, MP3::Tag が必要。iTunes への追加は Mac のみ)

### divide-auto.pl

波形から曲間を検索して、 divide-lame-iTunes.pl で使用する 分割設定ファイル のひな型を出力するスクリプトです。
(perl, Audio::Wav, Inline::C が必要)


## 大まかな作業の流れ

1. Audacity 等でアナログ音声を録音
2. 書き出し メニューから wavファイル を書き出し
3. divide-auto.pl で 分割設定ファイル のひな形を出力
4. 波形エディタで wavファイル を見ながら 分割設定ファイル の分割位置を修正
5. 分割設定ファイル に曲名やアーティスト名を追記する
6. divide-lame-iTunes.pl で分割, mp3圧縮, iTunes取り込み を行う


## divide-lame-iTunes.pl の使い方

### 使い方

1. 分割元のファイル があるディレクトリに 分割設定.txt を作成
2. 分割設定.txt に discog から曲リストをコピー
3. 分割設定.txt にアルバム名,年,ジャンル等のメタデータを記入
4. 波形エディタで 分割元のファイル の波形を見て、曲の分割点を決定。その分割点を 分割設定.txt に記入する
5. divide-lame-iTunes.pl 分割設定.txt を実行

### 分割設定ファイルのフォーマット

以下のタブ区切りデータを複数個書く事ができる。
（Discogのテーブルをコピーしたものに、少し手を加えれば完成する様になっている）

    ファイル名	アルバム名	年	ジャンル
    開始点位置	トラック番号	アーティスト	曲名
    分割点位置	トラック番号	アーティスト	曲名
    分割点位置	トラック番号	アーティスト	曲名
    終了点位置

このひとかたまりで、ファイル１つ分の分割指示になっている。

"開始点位置", "分割点位置", "終了点位置" は 時分秒.ミリ秒

    hh:mm:ss.sss

またはサンプル数

    99999s

の形式で指定できる。
終了点位置 の後ろには何も書かずすぐに改行する(タブ記号もダメ)

### 分割設定ファイルの動作設定行

分割設定ファイルに "#" で始まる動作設定行を書く事で、その行以下の動作を変更できる

* #fadein 0.3フェードイン時間を指定 デフォルトは 0.1
* #fadeout 0.3	フェードアウト時間を指定 デフォルトは 0.1
* #fade 0.3	フェードインとアウトをいっぺんに指定
* #normalize 1	ノーマライズする(1の時) デフォルトは 0 (しない)
* #lameoption -b 256 -h	圧縮オプション(lameにそのまま渡す)を指定 デフォルトは "-b 320 -h"

### 分割設定ファイルのコメント

"##" と "#" 2つで始まる行はコメント行。無視される。

### 分割設定ファイルの詳細

* 各項目の前後のスペースはトリムされる
* アルバム名, 年, ジャンルが空白の場合、前のファイルのデータが使われる。
* アーティスト名が空白の場合、前の行のデータが使われる。単独アーティストのアルバムなら、1曲目だけ設定を書けばよい。
* 曲名が空白の場合、連番を使って "Track 9" 等とつけられる。
* トラック番号が空白の場合、連番の数字がつく
* 連番はアルバムが変わる毎に（新しいアルバム名が指定される毎に）1からスタートする。

（Discogからリストをコピーした際に便利な機能）

* アーティスト名の後ろの – (Unicode 0x2013) や * はトリムされる。
* アーティスト名が XXXXX, The である場合 The XXXXX に置き換えられる。
* トラック名に英字等、数字以外の文字が含まれる場合は空白として扱われる。

### 分割設定ファイルのテンプレート

    #fade 0.1
    #normalize 1
    #lameoption -b 320 -h
    
    ##filename	albumname	year	genre
    ##starttime	number	artist	songname
    ##finishtime

## divide-auto.pl の使い方

### 分割設定ファイルを出力

    divide-auto.pl WAVFILE.wav

または、複数個の wav を続けて処理できます。

    divide-auto.pl WAVFILE1.wav WAVFILE2.wav ...

分割設定ファイルは上書きしない様に自動的に命名されます。

### 分割結果をプレビュー

DIVIDESETTING.txt による分割の 3トラック目 を聴く場合は

    divide-auto.pl DIVIDESETTING.txt 3

分割設定ファイルの替わりに wavファイル を指定すると、一番新しい分割設定ファイルを探して、その3トラック目を再生します。
    divide-auto.pl WAVFILE.wav 3


